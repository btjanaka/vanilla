const CPPN=function(){function t(t,e,n,a){const o=t+3,d="grey"==a?1:3,c=tf.sequential();let i=o;for(let t=0;t<n;++t)c.add(tf.layers.dense({inputShape:[i],units:e,useBias:!1,activation:"tanh",weights:[tf.randomNormal([i,e])]})),i=e;return c.add(tf.layers.dense({inputShape:[i],units:d,useBias:!1,activation:"sigmoid",weights:[tf.randomNormal([i,d])]})),c}function e(t){return tf.randomUniform([t],-1,1)}function n(t,e,n,a,o,d){return tf.tidy(()=>{const c=e.expandDims(0).tile([n,1]),i=tf.linspace(-1,1,n),l=tf.linspace(-1,1,a).expandDims(1),s=tf.ones([n,1]);i.dataSync().forEach((e,a)=>{const i=s.mul(tf.scalar(e)),u=tf.add(l.square(),i.square()).sqrt(),r=tf.concat([c,l,i,u],1),m=t.predict(r).arraySync(),p=(a+1)*n*4;let g=0;for(let t=a*n*4;t<p;t+=4){const e="grey"==o?[m[g][0],m[g][0],m[g][0]]:m[g];d.data[t]=255*e[0],d.data[t+1]=255*e[1],d.data[t+2]=255*e[2],d.data[t+3]=255,++g}})})}return{newModel:t,randomLatentVec:e,drawImage:n}}();!function(){function t(){n=CPPN.newModel(c,o,a,d)}function e(t,e){const n=document.getElementById(e);t.oninput=(()=>{n.innerHTML=t.value})}let n,a=8,o=16,d="grey",c=2;const i=16;let l=CPPN.randomLatentVec(i).dataSync();const s=document.getElementById("output-width");e(s,"output-width-val");const u=document.getElementById("output-height");e(u,"output-height-val");const r=document.getElementById("hidden-layers");e(r,"hidden-layers-val"),r.onchange=(()=>{a=parseInt(r.value,10),t()});const m=document.getElementById("hidden-dim");e(m,"hidden-dim-val"),m.onchange=(()=>{o=parseInt(m.value,10),t()});const p=document.getElementById("output-mode");p.onchange=(()=>{d=p.value,t()});const g=[],y=[],f=document.getElementById("latent-controls");for(let t=0;t<i;++t){const e=document.createElement("label");e.setAttribute("class","control-label"),e.setAttribute("for",`latent-${t}`),e.innerHTML=`Latent ${t+1}: ${l[t].toFixed(2)}`;const n=document.createElement("input");n.setAttribute("type","range"),n.setAttribute("min",-100),n.setAttribute("max",100),n.setAttribute("value",100*l[t]),n.setAttribute("step",1),n.setAttribute("class","slider"),n.setAttribute("id",`latent-${t}`),n.oninput=(()=>{l[t]=n.value/100,e.innerHTML=`Latent ${t+1}: ${l[t].toFixed(2)}`});const a=document.createElement("div");a.appendChild(e),a.appendChild(n),t>=c&&(a.style.display="none"),f.appendChild(a),y.push(a),g.push(n)}const h=document.getElementById("latent-size");e(h,"latent-size-val"),h.onchange=(()=>{c=parseInt(h.value,10);for(let t=0;t<i;++t)y[t].style.display=t<c?"block":"none";t()}),document.getElementById("button-restart").onclick=t,document.getElementById("button-randomize").onclick=(()=>{l=CPPN.randomLatentVec(i).dataSync();for(let t=0;t<i;++t)g[t].value=100*l[t],g[t].oninput()});const I=document.getElementById("output-image"),v=I.getContext("2d"),E=document.getElementById("button-draw");E.onclick=(()=>{const t=parseInt(s.value,10),e=parseInt(u.value,10),a=v.createImageData(t,e);I.width=t,I.height=e,CPPN.drawImage(n,tf.tensor1d(l.slice(0,c)),t,e,d,a),v.putImageData(a,0,0)});const b=document.getElementById("button-save");b.onclick=(()=>{b.download="image.png",b.href=I.toDataURL("image/png").replace(/^data:image\/[^;]/,"data:application/octet-stream")}),document.addEventListener("DOMContentLoaded",()=>{t(),E.onclick()})}();